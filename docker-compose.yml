version: '3.8'

services:
  camille-bot:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: camille-discord-bot
    restart: unless-stopped

    # Variables d'environnement
    environment:
      - NODE_ENV=production
      - TZ=Europe/Paris
      - DISCORD_TOKEN=${DISCORD_TOKEN}
      - GUILD_ID=${GUILD_ID}
      - CLIENT_ID=${CLIENT_ID}

    # Volumes pour persister les données
    volumes:
      - ./logs:/app/logs
      - ./daily_claim_usage:/app/daily_claim_usage
      - ./MONTHLY_USAGE:/app/MONTHLY_USAGE
      - ./lastVideoId.txt:/app/lastVideoId.txt
      - ./lastVideoId2.txt:/app/lastVideoId2.txt

    # Limites de ressources (ajustées pour Raspberry Pi 5)
    deploy:
      resources:
        limits:
          cpus: '2.0'
          memory: 2G
        reservations:
          cpus: '0.5'
          memory: 512M

    # Politique de redémarrage
    healthcheck:
      test: ["CMD-SHELL", "pgrep node || exit 1"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s


